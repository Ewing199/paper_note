<attachment contentEditable="false" data-atts="%5B%5D" data-aid=".atts-d6492fdd-bf94-4c8a-bc13-a27342062c0f"></attachment>
# 1. 进程与线程
## 1.1进程
>进程是对运行时程序的封装，是系统进行资源调度和分配的的基本单位，实现了**操作系统的并发**
## 1.2线程
> 线程是进程的子任务，是CPU调度和分派的基本单位，用于保证程序的实时性，实现**进程内部的并发**
线程是操作系统可识别的**最小执行和调度单位**

每个线程都**独自**占用一个虚拟处理器：独自的寄存器组，指令计数器和处理器状态
每个线程完成不同的任务，但是**共享**同一地址空间（也就是同样的动态内存，映射文件，目标代码等等），打开的文件队列和其他内核资源。

## 1.3区别
1.线程依赖于进程而存在。一个进程有多个线程，一个线程只属于一个进程
2.进程在执行过程中拥有**独立的内存单元**，而多个线程**共享进程的内存**。但是每个线程拥有自己的栈段，栈段又叫运行时段，用来存放所有**局部变量和临时变量**
3.进程是资源分配的最小单位，线程是CPU调度的最小单位
4.进程系统开销远大于线程------资源分配与回收的原因
5.线程通信，由于共享内存，可以直接通过全局变量的方式
6.进程相互不影响；线程挂掉导致进程挂掉
7.进程适应于多核、多机分布；线程适用于多核

## 1.4进程通信
1.管道
> **普通管道PIPE**：半双工（单向数据流动），只能用于父子进程或兄弟进程，存在内存中的特殊文件（可读写）
**命名管道FIFO**：无关进程间交换数据，存在文件系统中的特殊文件

2.系统IPC
>  消息队列:消息队列，是消息的链接表，存放在内核中。异步处理，主要目的是减少请求响应时间和解耦

> 信号量（semaphore）与已经介绍过的 IPC 结构不同，它是一个计数器，可以用来控制多个进程对共享资源的访问。信号量用于实现进程间的互斥与同步，而不是用于存储进程间通信数据

> 信号signal是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生

> 共享内存（Shared Memory）:它使得多个进程可以访问同一块内存空间，不同进程可以及时看到对方进程中对共享内存中数据得更新。这种方式需要依靠某种同步操作，如互斥锁和信号量等

3.套接字socket
socket也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同主机之间的进程通信

## 1.5线程通信
> 临界区：通过多线程的串行化来访问公共资源或一段代码，速度快，适合控制数据访问；

> 互斥量Synchronized/Lock：采用互斥对象机制，只有拥有互斥对象的线程才有访问公共资源的权限。因为互斥对象只有一个，所以可以保证公共资源不会被多个线程同时访问

> 信号量Semphare：为控制具有有限数量的用户资源而设计的，它允许多个线程在同一时刻去访问同一个资源，但一般需要限制同一时刻访问此资源的最大线程数目

> 事件(信号)，Wait/Notify：通过通知操作的方式来保持多线程同步，还可以方便的实现多线程优先级的比较操作

# 2.虚拟内存
**虚拟内存技术**使得不同进程在运行过程中，它所看到的是自己独自占有了当前系统的4G内存。所有进程共享同一物理内存，**每个进程只把自己目前需要的虚拟内存空间映射并存储到物理内存上**
**请求分页系统、请求分段系统和请求段页式系统**都是针对虚拟内存的，通过请求实现内存与外存的信息置换。

## 2.1虚拟内存的优点
> 1.扩大地址空间
2.内存保护。各自使用自己的虚拟空间
3.公平内存分配。虚拟空间大小相同
4.当进程通信时，可采用虚存共享的方式实现
5.节约物理内存。不同进程使用相同代码只需要存储一块
6.提供系统的并发。虚拟内存很适合在多道程序设计系统中使用
7.在程序需要分配连续的内存空间的时候，只需要在虚拟内存空间分配连续空间，而不需要实际物理内存的连续空间，可以利用碎片

## 2.2虚拟内存的代价
> 1.虚存的管理需要建立很多数据结构，这些数据结构要占用额外的内存
2.虚拟地址到物理地址的转换，增加了指令的执行时间。
3.页面的换入换出需要磁盘I/O，这是很耗时的
4.如果一页中只有一部分数据，会浪费内存

# 缺页中断
缺页中断：在请求分页系统中，可以通过查询页表中的状态位来确定所要访问的页面是否存在于内存中。每当所要访问的页面不在内存是，会产生一次缺页中断，此时操作系统会根据页表中的外存地址在外存中找到所缺的一页，将其调入内存。
> malloc()和mmap()等内存分配函数，在分配时只是建立了进程虚拟地址空间，并没有分配虚拟内存对应的物理内存。当进程访问这些没有建立映射关系的虚拟内存时，处理器自动触发一个缺页异常

缺页本身是一种中断，与一般的中断一样，需要经过4个处理步骤：
> 1、保护CPU现场
2、分析中断原因
3、转入缺页中断处理程序进行处理
4、恢复CPU现场，继续执行

