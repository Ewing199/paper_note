# 1.网络层:IP（网际协议）
## 1.1 ARP
*请求得知目标ip的物理地址*
在ARP高速缓存里放入一个IP地址到硬件地址的映射表，并为每个项目都设置生存时间：找到物理地址则写入ARP缓存以便快速通讯，找不到则将路由器IP地址解析为硬件地址，由路由器继续转发

## 1.2 IP报文的格式
1. 协议版本：4位，**IPV4:4，IPV6:6**
2. 首部长度：4位 **最大为60字节，为4字节的证书倍，固定长度20字节，最大60字节等**
3. 区分服务：8位 ，**一般未使用**
4. 总长度：16位，**首部长度+数据长度(不超过数据链路层规定的最大传送单元--MTU)**
5. 标识：16，**产生一个数据报，计数+1，数据报超度超过MTU的长度需要分片时，该字段被复制到所有分片中，即同一数据包的标识相同**
6. 标志：3，**最低位MF：0(没有分片)，1(还有分片)；中间位DF：0(允许分片)，1(不允许分片)**
7. 片偏移：13，**片在分组中的相对位置，便宜为8的整数倍，```offset = lenth(前片的数据长度)/8```**
8. 生存时间：8,**数据报在网络中的寿命，由原来的秒数已改为路由跳数限制**
9. 协议：8，**报文的协议，如ICMP，IGMP，TCP等等**
10. 首部检验和：16，**校验首部部分，每经过一次路由器，某些字段都会发生变化，计算方法```16位字为一段，检验和先置零，进行反码求和(按位相加，最高位进位结果+1），再取反码```**
11. 源地址：32
12. 目的地址：32

## 1.3 路由转发（不划分子网）
**（目的IP地址，下一跳地址）**
发送数据报时会不断的重复，查找路由表，通过目的IP计算硬件地址，写入MAC桢首部等过程，会造成一定的开销
>路由表的建立与更新


> 分组转发算法：
1.提取目的Ip 地址D，计算网络地址N
2.N直接与当前路由器相连，**直接交付**；否则，执行下一步
3.路由表中有到达网络D的路由，数据报传到路由表指向的路由器；否则，执行下一步
4.路由表中有到达网络N的路由，数据报传到路由表指向的路由器；否则，执行下一步
5.路由表中有默认路由，数据报传向默认路由器；否则，执行下一步
6.上报报文转发分组出错
*注意：若划分子网，每次找寻目的网络N时需要与子网掩码相&Ω*

## 1.4 划分子网
在IP地址中增加一个“子网号字段”，使两级IP变为三级IP

>划分子网的意义：
即在大型网络中可以划分出小块网络的方法，增加类灵活性，减少类主机数量
1.IP地址的空间利用率低
2.一个物理网络对应一个网络IP消耗太大
3.两级IP地址不灵活：两级即为**{网络号，主机号}**

>划分子网的解决办法：
1.从网络的**主机号**借用若干位作文子网号subnet-id，变为三级ip：**{网络号，子网号，主机号}**
2.对外该网络仍然为一个网络，该单位拥有许多物理网络
3.接收数据报，仍然是按照数据报的目的网络号找到本单位网的路由器。但是路由器会按照目的网络号和子网号找到目的子网，再转发给目的主机

> 子网掩码：使路由器能正确的提取目的Ip地址中要找的子网的网络地址，得出方法“网络号+借用的主机号全为1”
A类：默认0xFF000000，即255.0.0
B类：默认0xFFFF0000，即255.255.0.0
C类：默认0xFFFFFF00，即255.255.255.0

## 1.5 无分类编址CIDR
“sider”
两种写法，如```192.168.121.98/27或00010001*```
> 网络前缀：
**提出意义**
1.B类地址被分配殆尽
2.因特网主干上的路由表项目数急剧增长
3.IPV4地址空间即将耗尽
**解决办法**
1.无分类两级编址：**{网络前缀，主机号}/前缀位数**
2.网络前缀相同的的连续IP地址组成“CIDR地址块”，其中主机地址全0，全1一般不使用
3.地址掩码：网络前缀长度为全1的个数,*也可以扩充网络前缀划分子网*
*路由表可以利用CIDR地址块来查找目的网络，称为路由聚合，也称构成超网（如可以包含多个C类网络）*
4.最长前缀匹配：查找路由表时得到不止一个结果，其中一般取最长的结果
5.二查线索：把无分类编址的路由表存放在一种层次的数据结构中

## 1.6 ICMP









































